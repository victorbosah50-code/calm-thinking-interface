<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üåø Calm Thinking Interactive Journey üåø</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
<style>
html,body{margin:0;padding:0;height:100%;font-family:'Nunito',sans-serif;background:#000;overflow-y:auto;}
#bgVideo{position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-3;opacity:0.6;}
.rain{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:-2;overflow:hidden;}
.drop{position:absolute;width:2px;height:18px;background:rgba(255,255,255,0.35);top:-20px;animation-name:fall;animation-timing-function:linear;animation-iteration-count:infinite;}
@keyframes fall{to{transform:translateY(110vh);opacity:0;}}
.container{max-width:900px;margin:40px auto;padding:36px;background:rgba(255,255,255,.25);backdrop-filter:blur(14px);border-radius:24px;color:#000;text-align:center;}
img{width:100%;max-height:280px;object-fit:cover;border-radius:18px;margin:16px 0;}
textarea{width:100%;height:120px;padding:14px;border-radius:14px;border:2px solid #7fd3e8;font-family:Nunito;font-size:1rem;}
button{padding:12px 28px;margin:14px;border:none;border-radius:18px;background:#4a90e2;color:#fff;font-size:1rem;cursor:pointer;}
.card{background:rgba(255,255,255,.35);padding:24px;border-radius:22px;margin-top:20px;}
.breath{width:200px;height:200px;border-radius:50%;background:radial-gradient(circle,#b3e5fc,#81d4fa);margin:26px auto;display:flex;align-items:center;justify-content:center;font-size:1.4rem;font-weight:700;transition:2.5s;}
.expand{transform:scale(1.8);}
.small{font-size:.9rem;opacity:.85;}
</style>
</head>
<body>

<video autoplay muted loop id="bgVideo" src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/forest.mp4"></video>
<div class="rain" id="rain"></div>

<div class="container" id="app">
  <h1>üåø Calm Thinking Interactive Journey</h1>
  <p>Begin a deeply therapeutic, adaptive session personalized to you.</p>
  <label for="voiceSelect">Choose your voice:</label>
  <select id="voiceSelect">
    <option value="none" selected>No voice</option>
    <option value="male">Male</option>
    <option value="female">Female</option>
  </select>
  <br>
  <button id="startBtn">Begin Session</button>
</div>

<audio id="ambience" loop></audio>

<script>
const app=document.getElementById("app");
const ambience=document.getElementById("ambience");
const bgVideo=document.getElementById("bgVideo");
const rain=document.getElementById("rain");
const voiceSelect=document.getElementById("voiceSelect");
const synth=window.speechSynthesis;

let step=0,responses=[],selectedVoice='none',flow=[],mood='Neutral';

/* ---------- RAIN ---------- */
for(let i=0;i<150;i++){
  const drop=document.createElement("div");
  drop.className="drop";
  drop.style.left=Math.random()*100+"%";
  drop.style.animationDuration=(0.5+Math.random()*1.2)+"s";
  drop.style.animationDelay=(Math.random()*5)+"s";
  rain.appendChild(drop);
}

/* ---------- RANDOMIZED QUESTION SETS ---------- */
const questionSets=[
  [
    "What‚Äôs on your mind today?",
    "What feeling is strongest right now?",
    "What can you focus on controlling?",
    "What do you need to release?",
    "BREATH",
    "Name one small act of self-care you will do."
  ],
  [
    "Recall a positive moment from this week.",
    "What challenge feels heaviest?",
    "Which action was meaningful today?",
    "Identify something outside your control.",
    "BREATH",
    "What intention will guide your next hour?"
  ],
  [
    "How do you feel right now?",
    "What thought keeps returning?",
    "What can you let go?",
    "What can you embrace?",
    "BREATH",
    "Name one thing that brings calm to you."
  ]
];

/* ---------- NATURE IMAGE OPTIONS ---------- */
const natureImages=[
  "https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=900&q=80",
  "https://images.unsplash.com/photo-1506744038136-45673834b3fb?auto=format&fit=crop&w=900&q=80",
  "https://images.unsplash.com/photo-1506744038136-46273834b3fc?auto=format&fit=crop&w=900&q=80",
  "https://images.unsplash.com/photo-1506744038136-46273834b3fd?auto=format&fit=crop&w=900&q=80"
];

/* ---------- VOICE ---------- */
function speak(text){
  if(selectedVoice==='none') return;
  if(!synth) return;
  synth.cancel();
  const utter=new SpeechSynthesisUtterance(text);
  const voices=synth.getVoices();
  let chosenVoice;
  if(selectedVoice==='female') chosenVoice=voices.find(v=>v.name.toLowerCase().includes("female")) || voices.find(v=>v.lang.startsWith("en"));
  if(selectedVoice==='male') chosenVoice=voices.find(v=>v.name.toLowerCase().includes("male")) || voices.find(v=>v.lang.startsWith("en"));
  utter.voice=chosenVoice;
  utter.rate=0.9;
  utter.pitch=1;
  synth.speak(utter);
}

/* ---------- START SESSION ---------- */
document.getElementById("startBtn").onclick=()=>{
  selectedVoice=voiceSelect.value;
  ambience.src="https://www.orangefreesounds.com/wp-content/uploads/2016/04/Rainforest-sounds.mp3";
  ambience.volume=.45;
  ambience.play();
  flow=questionSets[Math.floor(Math.random()*questionSets.length)];
  renderStep();
};

/* ---------- RENDER STEP ---------- */
function renderStep(){
  if(step>=flow.length){conclude(); return;}
  if(flow[step]==="BREATH"){breathing(); return;}
  
  const userImg=natureImages[Math.floor(Math.random()*natureImages.length)];
  app.innerHTML=`
    <h2>${flow[step]}</h2>
    <img src="${userImg}" alt="Calm Nature">
    <textarea placeholder="Write freely..."></textarea>
    <button>Continue</button>
  `;
  speak(flow[step]);
  
  app.querySelector("button").onclick=()=>{
    const val=app.querySelector("textarea").value.trim();
    if(!val){alert("Write at least a few words.");return;}
    responses.push(val);
    analyzeMood(val);
    if(responses.length%2===0){adaptiveMicroGame(responses.slice(-2));} else {brainGame(step);}
  };
}

/* ---------- EMOTIONAL TONE ANALYSIS ---------- */
function analyzeMood(text){
  const lower=text.toLowerCase();
  let score=0;
  ["calm","peace","relax","joy","happy"].forEach(w=>{if(lower.includes(w)) score+=2;});
  ["stress","tired","worry","anxious"].forEach(w=>{if(lower.includes(w)) score-=2;});
  ["focus","goal","plan","success"].forEach(w=>{if(lower.includes(w)) score+=1;});
  if(score>=3) mood="Calm"; else if(score<=-2) mood="Stressed"; else if(score>0) mood="Motivated"; else mood="Neutral";
  dynamicBackground(mood);
}

/* ---------- DYNAMIC BACKGROUND BASED ON MOOD ---------- */
function dynamicBackground(mood){
  if(mood==="Calm") bgVideo.src=natureImages[0];
  else if(mood==="Stressed") bgVideo.src="https://images.unsplash.com/photo-1506744038136-46273834b3fe?auto=format&fit=crop&w=900&q=80";
  else if(mood==="Motivated") bgVideo.src=natureImages[2];
  else bgVideo.src=natureImages[3];
}

/* ---------- BRAIN GAMES ---------- */
function brainGame(i){
  const games=[
    "Write three thoughts you want to let go.",
    "Rewrite one sentence kindly.",
    "Identify one burden not yours to carry.",
    "Focus on one manageable action.",
    "",
    "Name one gentle act for today."
  ];
  if(!games[i]){step++;renderStep();return;}
  speak(games[i]);
  app.innerHTML=`
    <div class="card">
      <h3>üß† Therapeutic Focus</h3>
      <p>${games[i]}</p>
      <textarea></textarea>
      <button>Continue</button>
    </div>
  `;
  app.querySelector("button").onclick=()=>{step++;renderStep();};
}

/* ---------- MICRO-GAMES ADAPTIVE ---------- */
function adaptiveMicroGame(lastTwo){
  const txt=lastTwo.join(" ");
  const keywords=txt.match(/\b\w{4,}\b/g)||["calm","focus","mind"];
  const games=[triviaGame,memoryGame,patternGame];
  games[Math.floor(Math.random()*games.length)](keywords);
}

/* ---------- TRIVIA ---------- */
function triviaGame(words){
  const q="Which word resonates most with you now?";
  const opts=[...words].sort(()=>Math.random()-0.5);
  app.innerHTML=`<div class="card"><h3>üß© Personalized Trivia</h3><p>${q}</p>${opts.map(o=>`<button>${o}</button>`).join("")}</div>`;
  app.querySelectorAll("button").forEach(b=>{b.onclick=()=>{alert(`You chose: ${b.textContent}`);step++;renderStep();};});
}

/* ---------- MEMORY ---------- */
function memoryGame(words){
  const seq=words.slice(0,3);
  let user=[];
  app.innerHTML=`<div class="card"><h3>üß† Memory Sequence</h3><p>Memorize: ${seq.join(" ")}</p><button id="startMem">Start Recall</button></div>`;
  document.getElementById("startMem").onclick=()=>{
    app.innerHTML=`<div class="card"><h3>Recall Sequence</h3>${seq.map(s=>`<button>${s}</button>`).join("")}</div>`;
    const btns=app.querySelectorAll("button");
    btns.forEach((b,i)=>{b.onclick=()=>{user.push(b.textContent);b.disabled=true;if(user.length===seq.length){alert(`‚úÖ Correct: ${user.filter((v,i)=>v===seq[i]).length}/${seq.length}`);step++;renderStep();}};});
  };
}

/* ---------- PATTERN ---------- */
function patternGame(words){
  const pat=words.map(w=>w[0]+"*");
  let user=[];
  app.innerHTML=`<div class="card"><h3>üåà Pattern Spotting</h3><p>Click in alternating pattern:</p>${pat.map(p=>`<button>${p}</button>`).join("")}</div>`;
  app.querySelectorAll("button").forEach((b,i)=>{b.onclick=()=>{user.push(b.textContent);b.disabled=true;if(user.length===pat.length){alert(`‚úÖ Matched ${user.filter((v,i)=>v===pat[i]).length}/${pat.length}`);step++;renderStep();}};});
}

/* ---------- BREATHING ---------- */
function breathing(){
  let p=0;
  speak("Follow the breath. Inhale. Hold. Exhale.");
  app.innerHTML=`
    <h2>üåå Guided Breathing</h2>
    <p class="small">Follow the rhythm. Nothing else to do.</p>
    <div class="breath" id="b">Inhale</div>
    <button>Continue</button>
  `;
  const b=document.getElementById("b");
  const t=setInterval(()=>{
    if(p===0){b.textContent="Inhale";b.classList.add("expand")}
    if(p===1){b.textContent="Hold"}
    if(p===2){b.textContent="Exhale";b.classList.remove("expand")}
    p=(p+1)%3;
  },2200);
  app.querySelector("button").onclick=()=>{clearInterval(t);step++;renderStep();};
}

/* ---------- CONCLUSION ---------- */
function conclude(){
  speak("You showed up for yourself today.");
  const userText=responses.join(" ").toLowerCase();
  const word=userText.match(/\b\w{5,}\b/g)?.sort((a,b)=>b.length-a.length)[0]||"Presence";
  const quote=userText.includes("stress")?"Even tension transforms when observed with care.":userText.includes("joy")?"Joy deepens when noticed fully.":"Reflecting on yourself brings clarity.";
  const idiom=userText.includes("control")?"Let go to grow.":"Step by step, progress is made.";
  const parable=userText.includes("burden")?"Even the heaviest load eases when shared.":"A traveler paused under a tree and felt renewed.";
  const keywords=userText.match(/\b\w+\b/g)||["mind"];
  const joke=[`Why did the ${keywords[0]} go on a walk? To clear its thoughts!`,`What did one thought say to another? Let's meditate!`,`Why did the brain take a break? To recharge focus!`][Math.floor(Math.random()*3)];

  app.innerHTML=`
    <h2>üå± Session Complete</h2>
    <div class="card"><h3>üìñ Word of the Day</h3><p><strong>${word}</strong><br>From your reflections.</p></div>
    <div class="card"><h3>üí¨ Quote of the Day</h3><p><em>${quote}</em></p></div>
    <div class="card"><h3>üó£Ô∏è Idiom of the Day</h3><p>${idiom}</p></div>
    <div class="card"><h3>üìú Parable of the Day</h3><p>${parable}</p></div>
    <div class="card"><h3>üòÇ Joke of the Day</h3><p>${joke}</p></div>
    <div class="card"><h3>üîÆ VR / 3D Mini-Meditation</h3><p>Imagine a calm world or open a 3D/VR meditation space here (placeholder).</p></div>
    <p class="small">Return anytime. This space remembers you.</p>
  `;
}
</script>
</body>
</html>
