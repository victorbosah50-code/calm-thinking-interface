<!-- Keep the previous HTML & CSS mostly the same -->
<style>
/* Raindrops already defined... we’ll add a "pulse" class */
.raindrop.pulse {
  background: rgba(255,255,255,0.9);
  transform: scaleY(1.5);
  box-shadow: 0 0 8px rgba(255,255,255,0.7);
  transition: transform 0.3s, background 0.3s, box-shadow 0.3s;
}
</style>

<script>
// Existing code...

// Storm animation function (updated)
function startStormAnimation(){
  const drops = [];
  for(let i=0;i<50;i++){
    const drop = document.createElement("div");
    drop.className="raindrop";
    drop.style.left=Math.random()*100+"%";
    drop.style.animationDuration=(0.5+Math.random()*1.5)+"s";
    drop.style.height=(5+Math.random()*10)+"px";
    container.appendChild(drop);
    drops.push(drop);
  }

  // Thunder flashes
  setInterval(()=>{
    if(Math.random()<0.3){
      thunderFlash.style.opacity="1";
      setTimeout(()=>{ thunderFlash.style.opacity="0"; },100);
    }
  },3000);

  // Save drops globally to pulse later
  window.stormDrops = drops;
}

// Updated Breathing Exercise
function startBreathingExercise(){
  const pattern = breathingSelect.value;
  const circle=document.createElement("div"); circle.className="breathing-circle"; circle.innerText="Breathe";
  container.appendChild(circle);

  const instructions = document.createElement("p");
  if(pattern==="478") instructions.innerText="Inhale 4s → Hold 7s → Exhale 8s. Repeat!";
  else instructions.innerText="Inhale 4s → Hold 4s → Exhale 4s → Hold 4s. Repeat!";
  container.appendChild(instructions);

  let inhale=4000, hold=7000, exhale=8000;
  if(pattern==="box"){ inhale=4000; hold=4000; exhale=4000; }

  let cycleStep=0;
  const cycle = () => {
    cycleStep++;
    // Expand circle
    circle.classList.add("expanding");
    pulseRaindrops(true); // inhale phase = pulse active
    setTimeout(()=>{
      // Hold phase
      pulseRaindrops(false); // hold, no pulse
      setTimeout(()=>{
        // Exhale
        circle.classList.remove("expanding");
        pulseRaindrops(false); // exhale = gentle
        setTimeout(cycle, exhale);
      },hold);
    },inhale);
  };
  cycle();

  // Next button
  const nextBtn=document.createElement("button"); nextBtn.innerText="Next";
  nextBtn.onclick=nextStep;
  container.appendChild(nextBtn);
}

// Pulse raindrops
function pulseRaindrops(active){
  if(!window.stormDrops) return;
  window.stormDrops.forEach(drop=>{
    if(active) drop.classList.add("pulse");
    else drop.classList.remove("pulse");
  });
}

// Existing nextStep() and conclusion functions...
</script>
