<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>üåø Calm Thinking</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
<link id="favicon" rel="icon" href="https://source.unsplash.com/32x32/?nature">

<style>
html,body{
  margin:0;height:100%;font-family:'Nunito',sans-serif;
  background:black;overflow:hidden;
}
video{
  position:fixed;top:0;left:0;width:100%;height:100%;
  object-fit:cover;z-index:-2;opacity:.55;
}
#flash{
  position:fixed;inset:0;
  background:white;opacity:0;
  z-index:-1;pointer-events:none;
}
.container{
  max-width:900px;margin:auto;
  background:rgba(255,255,255,.25);
  backdrop-filter:blur(12px);
  padding:30px;border-radius:20px;
  text-align:center;color:#111;
}
button{
  padding:12px 22px;border:none;
  border-radius:12px;
  background:#4a90e2;color:white;
  cursor:pointer;margin:8px;
}
button:hover{transform:scale(1.05)}
textarea{
  width:100%;height:110px;
  border-radius:12px;padding:12px;
  border:2px solid #7fd3e8;
}
.breathing{
  width:180px;height:180px;border-radius:50%;
  margin:20px auto;
  background:radial-gradient(circle,#a8edea,#89dceb);
  display:flex;align-items:center;justify-content:center;
  font-size:1.3rem;font-weight:bold;
  transition:1.5s;
}
.expand{transform:scale(1.7)}
canvas{border-radius:14px;background:#145214}
.grid{
  display:grid;grid-template-columns:repeat(3,1fr);
  gap:10px;margin-top:15px;
}
.cell{
  background:white;height:90px;
  display:flex;align-items:center;
  justify-content:center;font-size:2rem;
  cursor:pointer;border-radius:10px;
}
</style>
</head>

<body>

<video autoplay muted loop>
  <source src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4">
</video>

<div id="flash"></div>

<div class="container" id="app">
  <h1>üåø Calm Thinking</h1>
  <p>Mindful clarity through interaction</p>
  <button id="startBtn">Start</button>
</div>

<audio id="rain" loop src="https://www.orangefreesounds.com/wp-content/uploads/2016/04/Rainforest-sounds.mp3"></audio>
<audio id="thunder" src="https://www.orangefreesounds.com/wp-content/uploads/2014/10/Thunder-sound-effect.mp3"></audio>

<script>
/* ---------------- STATE ---------------- */
const app=document.getElementById("app");
const rain=document.getElementById("rain");
const thunder=document.getElementById("thunder");
const flash=document.getElementById("flash");

let step=0;
let progress=JSON.parse(localStorage.getItem("progress")) || {
  steps:0,games:0,score:0
};

const questions=[
 "What‚Äôs on your mind?",
 "What is certain?",
 "What assumptions exist?",
 "What can you control?",
 "BREATH",
 "What is your next small step?"
];

/* ---------------- START ---------------- */
startBtn.onclick=()=>{
  rain.volume=.5; rain.play();
  lightning();
  renderStep();
};

/* ---------------- LIGHTNING ---------------- */
function lightning(){
  setInterval(()=>{
    flash.style.opacity=.9;
    thunder.currentTime=0;
    thunder.play();
    setTimeout(()=>flash.style.opacity=0,120);
  },Math.random()*15000+8000);
}

/* ---------------- STEPS ---------------- */
function renderStep(){
  document.title=questions[step];
  favicon.href=`https://source.unsplash.com/32x32/?nature,${step}`;

  if(questions[step]==="BREATH"){ breathing(); return; }

  app.innerHTML=`
    <h2>${questions[step]}</h2>
    <textarea></textarea>
    <button>Next</button>
  `;

  app.querySelector("button").onclick=()=>{
    progress.steps++;
    localStorage.setItem("progress",JSON.stringify(progress));
    focusGame();
  };
}

/* ---------------- BREATH ---------------- */
function breathing(){
  let phase=0;
  app.innerHTML=`
    <h2>Breathe</h2>
    <div class="breathing" id="b">Inhale</div>
    <button>Continue</button>
  `;
  const b=document.getElementById("b");
  const timer=setInterval(()=>{
    if(phase===0){b.textContent="Inhale";b.classList.add("expand")}
    if(phase===1){b.textContent="Hold"}
    if(phase===2){b.textContent="Exhale";b.classList.remove("expand")}
    phase=(phase+1)%3;
  },2000);

  app.querySelector("button").onclick=()=>{
    clearInterval(timer);
    step++; renderStep();
  };
}

/* ---------------- FOCUS GAME ---------------- */
function focusGame(){
  progress.games++;
  app.innerHTML=`
    <h2>üß† Focus Game</h2>
    <p>Click numbers in order</p>
    <div class="grid" id="g"></div>
  `;
  const nums=[1,2,3,4,5,6,7,8,9].sort(()=>Math.random()-.5);
  let cur=1;
  nums.forEach(n=>{
    const d=document.createElement("div");
    d.className="cell";d.textContent=n;
    d.onclick=()=>{
      if(n===cur){d.style.background="#a8edea";cur++;
        if(cur===10){step++;renderStep();}
      }
    };
    g.appendChild(d);
  });
}

/* ---------------- CONCLUSION ---------------- */
function conclusion(){
  app.innerHTML=`
    <h2>üéâ Complete</h2>
    <p>Steps: ${progress.steps}<br>Games: ${progress.games}</p>
    <button onclick="basketball()">üèÄ Basketball</button>
    <button onclick="boardMenu()">‚ôüÔ∏è Board Games</button>
  `;
}

/* ---------------- BASKETBALL ---------------- */
function basketball(){
  app.innerHTML=`<h2>üèÄ Focus Shot</h2><canvas id="c" width="500" height="300"></canvas>`;
  const c=document.getElementById("c"),x=c.getContext("2d");
  let ball={x:80,y:240,vx:0,vy:0,shot:false};
  const rim={x:420,y:160,r:18};

  c.onclick=()=>{
    if(!ball.shot){ball.vx=6;ball.vy=-8;ball.shot=true;}
  };

  function loop(){
    x.clearRect(0,0,500,300);
    ball.vy+=.4;ball.x+=ball.vx;ball.y+=ball.vy;
    if(ball.y>240){ball.y=240;ball.shot=false;}

    const d=Math.hypot(ball.x-rim.x,ball.y-rim.y);
    if(d<rim.r){progress.score++;}

    x.beginPath();x.arc(ball.x,ball.y,10,0,7);x.fillStyle="orange";x.fill();
    x.beginPath();x.arc(rim.x,rim.y,rim.r,0,7);x.strokeStyle="red";x.stroke();

    requestAnimationFrame(loop);
  }
  loop();
}

/* ---------------- BOARD GAMES ---------------- */
function boardMenu(){
  app.innerHTML=`
    <h2>‚ôüÔ∏è Board Games</h2>
    <button onclick="ticTacToe()">Tic-Tac-Toe</button>
  `;
}

function ticTacToe(){
  let turn="X";
  app.innerHTML=`<h2>Tic-Tac-Toe</h2><div class="grid" id="g"></div>`;
  for(let i=0;i<9;i++){
    const c=document.createElement("div");
    c.className="cell";
    c.onclick=()=>{
      if(!c.textContent){c.textContent=turn;turn=turn==="X"?"O":"X";}
    };
    g.appendChild(c);
  }
}

/* ---------------- AUTO FINISH ---------------- */
setInterval(()=>{
  if(step>=questions.length) conclusion();
},400);
</script>
</body>
</html>
