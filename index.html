<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Calm Thinking</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">

<style>
html,body{
  margin:0;height:100%;font-family:Nunito;
  background:black;overflow:hidden;color:#111;
}
#bg{
  position:fixed;inset:0;z-index:-3;
  background:radial-gradient(circle at bottom,#001,#000);
}
.star{
  position:absolute;width:2px;height:2px;
  background:white;border-radius:50%;
  opacity:.8;animation:twinkle 3s infinite alternate;
}
@keyframes twinkle{to{opacity:.2}}
#flash{position:fixed;inset:0;background:white;opacity:0;pointer-events:none}
.container{
  max-width:920px;margin:auto;
  background:rgba(255,255,255,.25);
  backdrop-filter:blur(14px);
  padding:30px;border-radius:20px;
  text-align:center;
}
button{
  padding:12px 22px;border:none;border-radius:14px;
  background:#4a90e2;color:white;font-size:1rem;
  margin:6px;
}
canvas{border-radius:14px;touch-action:none}
textarea{
  width:100%;height:110px;border-radius:12px;
  padding:12px;border:2px solid #7fd3e8;
}
.breath{
  width:180px;height:180px;border-radius:50%;
  background:radial-gradient(circle,#b3e5fc,#81d4fa);
  margin:20px auto;display:flex;
  align-items:center;justify-content:center;
  font-weight:bold;transition:2s;
}
.expand{transform:scale(1.8)}
.grid{display:grid;grid-template-columns:repeat(8,1fr);max-width:400px;margin:auto}
.cell{
  aspect-ratio:1;background:#eee;
  display:flex;align-items:center;justify-content:center;
  font-size:1.4rem;cursor:pointer;
}
.dark{background:#666;color:white}
</style>
</head>

<body>

<div id="bg"></div>
<div id="flash"></div>

<div class="container" id="app">
  <h1>üåø Calm Thinking</h1>
  <p>Focus ‚Ä¢ Games ‚Ä¢ Mindfulness</p>
  <button id="start">Start</button>
</div>

<audio id="rain" loop src="https://www.orangefreesounds.com/wp-content/uploads/2016/04/Rainforest-sounds.mp3"></audio>
<audio id="thunder" src="https://www.orangefreesounds.com/wp-content/uploads/2014/10/Thunder-sound-effect.mp3"></audio>

<script>
/* ---------- GLOBAL ---------- */
const app=document.getElementById("app");
const rain=document.getElementById("rain");
const thunder=document.getElementById("thunder");
const flash=document.getElementById("flash");
let step=0;
let moodMemory=[];

/* ---------- STARS ---------- */
for(let i=0;i<120;i++){
  const s=document.createElement("div");
  s.className="star";
  s.style.left=Math.random()*100+"%";
  s.style.top=Math.random()*100+"%";
  s.style.animationDuration=2+Math.random()*4+"s";
  document.body.appendChild(s);
}

/* ---------- LIGHTNING ---------- */
setInterval(()=>{
  flash.style.opacity=.9;
  thunder.currentTime=0;
  thunder.play();
  setTimeout(()=>flash.style.opacity=0,150);
},12000+Math.random()*8000);

/* ---------- QUESTIONS ---------- */
const questions=[
 "What‚Äôs on your mind right now?",
 "What feels heavy?",
 "What can you control?",
 "BREATH",
 "What‚Äôs one kind thought?"
];

/* ---------- START ---------- */
start.onclick=()=>{
  rain.volume=.45;rain.play();
  renderStep();
};

/* ---------- AI TONE ---------- */
function analyzeTone(text){
  const t=text.toLowerCase();
  if(/tired|overwhelmed|anxious|stressed/.test(t)) return "stressed";
  if(/excited|ready|motivated/.test(t)) return "motivated";
  if(/calm|okay|fine|peace/.test(t)) return "calm";
  return "neutral";
}

/* ---------- STEPS ---------- */
function renderStep(){
  if(step>=questions.length){ menu(); return; }

  if(questions[step]==="BREATH"){ breath(); return; }

  app.innerHTML=`
    <h2>${questions[step]}</h2>
    <textarea placeholder="Type honestly..."></textarea>
    <button>Continue</button>
  `;
  app.querySelector("button").onclick=()=>{
    const txt=app.querySelector("textarea").value;
    const tone=analyzeTone(txt);
    moodMemory.push(tone);
    app.innerHTML=`<p>Your tone feels <b>${tone}</b>. Take a moment.</p>`;
    setTimeout(()=>{step++;renderStep();},1500);
  };
}

/* ---------- BREATH ---------- */
function breath(){
  let p=0;
  app.innerHTML=`
    <h2>üåå Star Breathing</h2>
    <div class="breath" id="b">Inhale</div>
    <button>Continue</button>
  `;
  const b=document.getElementById("b");
  const t=setInterval(()=>{
    if(p===0){b.textContent="Inhale";b.classList.add("expand")}
    if(p===1){b.textContent="Hold"}
    if(p===2){b.textContent="Exhale";b.classList.remove("expand")}
    p=(p+1)%3;
  },2200);
  app.querySelector("button").onclick=()=>{
    clearInterval(t);step++;renderStep();
  };
}

/* ---------- MENU ---------- */
function menu(){
  app.innerHTML=`
    <h2>Choose a Game</h2>
    <button onclick="pool()">üé± 8-Ball Pool</button>
    <button onclick="chess()">‚ôüÔ∏è Chess vs AI</button>
  `;
}

/* ---------- POOL (MULTI) ---------- */
function pool(){
  app.innerHTML=`
    <h2>üé± 8-Ball Pool (Local Multiplayer)</h2>
    <p id="turn">Player 1 Turn</p>
    <canvas id="p" width="620" height="320"></canvas>
  `;
  const c=p,ctx=c.getContext("2d");
  let turn=1;

  const balls=[];
  const R=10;
  for(let i=0;i<8;i++)
    balls.push({x:180+i*22,y:160,vx:0,vy:0,alive:true});

  const cue={x:500,y:160,vx:0,vy:0};

  c.addEventListener("touchstart",shoot);
  c.addEventListener("mousedown",shoot);

  function shoot(e){
    if(Math.abs(cue.vx)+Math.abs(cue.vy)>1) return;
    const r=c.getBoundingClientRect();
    const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left;
    const y=(e.touches?e.touches[0].clientY:e.clientY)-r.top;
    const a=Math.atan2(y-cue.y,x-cue.x);
    cue.vx=Math.cos(a)*6; cue.vy=Math.sin(a)*6;
    turn=turn===1?2:1;
    turn.textContent="Player "+turn+" Turn";
  }

  function loop(){
    ctx.clearRect(0,0,620,320);
    balls.forEach(b=>{
      if(!b.alive)return;
      b.x+=b.vx;b.y+=b.vy;
      b.vx*=.98;b.vy*=.98;
      ctx.beginPath();ctx.arc(b.x,b.y,R,0,7);ctx.fill();
    });
    cue.x+=cue.vx;cue.y+=cue.vy;
    cue.vx*=.98;cue.vy*=.98;
    ctx.beginPath();ctx.arc(cue.x,cue.y,R,0,7);ctx.fillStyle="white";ctx.fill();
    requestAnimationFrame(loop);
  }
  loop();
}

/* ---------- CHESS (AI) ---------- */
function chess(){
  const board=[
    "rnbqkbnr",
    "pppppppp",
    "........",
    "........",
    "........",
    "........",
    "PPPPPPPP",
    "RNBQKBNR"
  ];
  let sel=null;

  app.innerHTML=`<h2>‚ôüÔ∏è Chess vs AI</h2><div class="grid" id="g"></div>`;
  board.forEach((row,y)=>{
    [...row].forEach((p,x)=>{
      const d=document.createElement("div");
      d.className="cell "+((x+y)%2?"dark":"");
      d.textContent=p==="."?"":p;
      d.onclick=()=>{
        if(sel){ board[y]=replace(board[y],x,sel.p); sel=null; render(); }
        else if(p!==".") sel={x,y,p};
      };
      g.appendChild(d);
    });
  });
  function render(){ chess(); }
}
function replace(s,i,c){ return s.substring(0,i)+c+s.substring(i+1); }
</script>
</body>
</html>
