<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üåø Calm Thinking</title>

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
<link id="favicon" rel="icon" href="https://source.unsplash.com/32x32/?nature">

<style>
html,body{
  margin:0;height:100%;font-family:'Nunito',sans-serif;
  display:flex;justify-content:center;align-items:center;
  background:black;overflow:hidden;
}
video{
  position:fixed;top:0;left:0;width:100%;height:100%;
  object-fit:cover;z-index:-2;opacity:.6;
}
.container{
  width:90%;max-width:850px;
  background:rgba(255,255,255,.25);
  backdrop-filter:blur(10px);
  padding:30px;border-radius:18px;
  text-align:center;color:black;
}
button{
  padding:12px 22px;border:none;border-radius:10px;
  background:#4a90e2;color:white;font-size:1rem;
  cursor:pointer;margin:10px;
}
button:hover{transform:scale(1.05)}
textarea{
  width:100%;height:120px;
  border-radius:10px;padding:12px;
  border:2px solid #a0d8ef;font-size:1rem;
}
.breathing{
  width:180px;height:180px;border-radius:50%;
  margin:20px auto;
  display:flex;align-items:center;justify-content:center;
  font-size:1.4rem;font-weight:bold;
  background:radial-gradient(circle,#a8edea,#89dceb);
  transition:1s;
}
.expand{transform:scale(1.8)}
canvas{background:#145214;border-radius:12px;margin-top:15px}
.game-box{
  background:rgba(255,255,255,.2);
  border-radius:12px;padding:15px;margin-top:15px;
}
</style>
</head>

<body>

<video id="bgVideo" autoplay muted loop>
  <source src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4">
</video>

<div class="container" id="app">
  <h1>üåø Calm Thinking üåø</h1>
  <p>Press start to begin your mindful journey</p>
  <button id="startBtn">Start</button>
</div>

<audio id="ambient" loop></audio>

<script>
/* -------------------- CORE STATE -------------------- */
const app = document.getElementById("app");
const bgVideo = document.getElementById("bgVideo");
const ambient = document.getElementById("ambient");
const favicon = document.getElementById("favicon");

let step = 0;
let responses = [];
let breatheTimer = null;

/* -------------------- STEPS -------------------- */
const steps = [
  "What‚Äôs on your mind right now?",
  "What facts do you know for sure?",
  "What assumptions are you making?",
  "What can you control?",
  "BREATH",
  "What is one small next step?"
];

/* -------------------- START BUTTON (FIXED) -------------------- */
document.getElementById("startBtn").onclick = () => {
  ambient.src = "https://www.orangefreesounds.com/wp-content/uploads/2016/04/Rainforest-sounds.mp3";
  ambient.volume = .5;
  ambient.play();

  renderStep();
};

/* -------------------- RENDER STEPS -------------------- */
function renderStep(){
  clearInterval(breatheTimer);

  favicon.href = `https://source.unsplash.com/32x32/?nature,${step}`;
  document.title = `üåø ${steps[step]}`;

  if(steps[step] === "BREATH"){
    renderBreathing();
    return;
  }

  app.innerHTML = `
    <h1>${steps[step]}</h1>
    <textarea placeholder="Type your thoughts..."></textarea>
    <button>Next</button>
  `;

  app.querySelector("button").onclick = () => {
    const txt = app.querySelector("textarea").value.trim();
    if(!txt) return alert("Please type something");
    responses.push(txt);
    renderBrainGame(txt);
  };
}

/* -------------------- BREATHING (FIXED) -------------------- */
function renderBreathing(){
  app.innerHTML = `
    <h1>ü´Å Breathing</h1>
    <div class="breathing" id="circle">Inhale</div>
    <button>Next</button>
  `;

  const circle = document.getElementById("circle");
  let phase = 0;

  breatheTimer = setInterval(()=>{
    if(phase===0){circle.textContent="Inhale";circle.classList.add("expand")}
    if(phase===1){circle.textContent="Hold"}
    if(phase===2){circle.textContent="Exhale";circle.classList.remove("expand")}
    phase = (phase+1)%3;
  },2000);

  app.querySelector("button").onclick = ()=>{
    clearInterval(breatheTimer);
    step++;
    renderStep();
  };
}

/* -------------------- BRAIN GAME (NEW) -------------------- */
function renderBrainGame(text){
  const letters = [...new Set(text.replace(/[^a-z]/gi,"").toUpperCase())];

  app.innerHTML = `
    <h1>üß† Focus Game</h1>
    <div class="game-box">
      <p>Click all unique letters from your thought</p>
      <div id="letters"></div>
    </div>
  `;

  const box = document.getElementById("letters");
  let found = 0;

  letters.forEach(l=>{
    const b = document.createElement("button");
    b.textContent = l;
    b.onclick = ()=>{
      b.disabled=true;
      found++;
      if(found===letters.length){
        step++;
        renderStep();
      }
    };
    box.appendChild(b);
  });
}

/* -------------------- CONCLUSION -------------------- */
function renderConclusion(){
  app.innerHTML = `
    <h1>üéâ Well Done</h1>
    <p>You completed the journey</p>
    <button onclick="playPool()">üé± 8-Ball Pool</button>
  `;
}

/* -------------------- POOL GAME (REALISTIC) -------------------- */
function playPool(){
  app.innerHTML = `
    <h1>üé± 8-Ball Pool</h1>
    <canvas id="pool" width="600" height="320"></canvas>
    <p id="score">Score: 0</p>
  `;

  const c = document.getElementById("pool");
  const ctx = c.getContext("2d");
  const scoreEl = document.getElementById("score");

  const R = 10;
  let score = 0;

  const pockets = [
    {x:10,y:10},{x:300,y:10},{x:590,y:10},
    {x:10,y:310},{x:300,y:310},{x:590,y:310}
  ];

  const balls = [];
  for(let i=0;i<8;i++){
    balls.push({x:150+i*22,y:160,dx:0,dy:0,color:["yellow","blue","red","purple","orange","green","brown","black"][i],dead:false});
  }

  const cue = {x:500,y:160,dx:0,dy:0};

  c.onclick = e=>{
    const r=c.getBoundingClientRect();
    const a=Math.atan2(e.clientY-r.top-cue.y,e.clientX-r.left-cue.x);
    cue.dx=Math.cos(a)*5; cue.dy=Math.sin(a)*5;
  };

  function collide(a,b){
    const dx=b.x-a.x,dy=b.y-a.y;
    const d=Math.hypot(dx,dy);
    if(d<2*R){
      const ang=Math.atan2(dy,dx);
      a.dx=-Math.cos(ang);a.dy=-Math.sin(ang);
      b.dx=Math.cos(ang);b.dy=Math.sin(ang);
    }
  }

  function loop(){
    ctx.clearRect(0,0,c.width,c.height);

    pockets.forEach(p=>{
      ctx.beginPath();ctx.arc(p.x,p.y,15,0,Math.PI*2);
      ctx.fillStyle="black";ctx.fill();
    });

    balls.forEach(b=>{
      if(b.dead) return;
      balls.forEach(o=>{if(b!==o && !o.dead) collide(b,o)});
      b.x+=b.dx;b.y+=b.dy;b.dx*=.98;b.dy*=.98;

      pockets.forEach(p=>{
        if(Math.hypot(b.x-p.x,b.y-p.y)<15){
          b.dead=true; score++; scoreEl.textContent="Score: "+score;
        }
      });

      ctx.beginPath();
      ctx.arc(b.x,b.y,R,0,Math.PI*2);
      ctx.fillStyle=b.color;ctx.fill();
    });

    cue.x+=cue.dx;cue.y+=cue.dy;cue.dx*=.98;cue.dy*=.98;
    ctx.beginPath();ctx.arc(cue.x,cue.y,R,0,Math.PI*2);
    ctx.fillStyle="white";ctx.fill();

    requestAnimationFrame(loop);
  }
  loop();
}

/* AUTO FINISH */
const finishCheck = setInterval(()=>{
  if(step>=steps.length){
    clearInterval(finishCheck);
    renderConclusion();
  }
},300);
</script>
</body>
</html>
